<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üí∞ Earnly Pro - Premium Earning Platform</title>
    
    <!-- Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- Unity Ads SDK -->
    <script src="https://webgl.unityads.unity3d.com/main.js"></script>
    
    <style>
        /* ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá‡¶∞ ‡¶∏‡¶ï‡¶≤ CSS ‡¶ï‡ßã‡¶° ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶∞‡¶æ‡¶ñ‡ßÅ‡¶® */
        /* ... ‡¶™‡ßÅ‡¶∞‡ßã‡¶®‡ßã CSS ‡¶ï‡ßã‡¶° ... */
        
        /* ‡¶®‡¶§‡ßÅ‡¶® Unity Ad Container */
        .unity-ad-container {
            width: 100%;
            height: 250px;
            background: rgba(0,0,0,0.2);
            border-radius: 15px;
            overflow: hidden;
            margin: 15px 0;
            position: relative;
            border: 2px dashed var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .ad-loading {
            text-align: center;
            padding: 20px;
        }
        
        .ad-placeholder {
            font-size: 48px;
            margin-bottom: 10px;
        }
        
        .ad-loading-text {
            color: var(--gray);
            font-size: 14px;
        }
    </style>
</head>
<body>
    <!-- ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá‡¶∞ HTML ‡¶ï‡ßã‡¶° -->

    <script>
        // ==================== CONFIGURATION ====================
        const CONFIG = {
            pointsPerAd: 0.5,
            pointsToMoney: 4000,
            moneyPerPoint: 0.005,
            dailyAdLimit: 50,
            minWithdrawal: 4000,
            withdrawalFee: 10,
            referralBonus: 100,
            botUsername: 'Earnly_Official_bot',
            // Unity Ads Configuration
            unityGameId: '18968367782959',
            testMode: true, // Production-‡¶è false ‡¶ï‡¶∞‡ßÅ‡¶®
            adRewardAmount: 0.5,
            minAdInterval: 30000 // 30 ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°
        };
        
        // ==================== UNITY ADS CONFIGURATION ====================
        const UNITY_CONFIG = {
            gameId: CONFIG.unityGameId,
            testMode: CONFIG.testMode,
            onInitComplete: () => {
                console.log('‚úÖ Unity Ads Ready!');
                showNotification('üé¨ Ads are ready to watch!');
                document.getElementById('adButton').disabled = false;
                document.getElementById('adButton').innerHTML = '‚ñ∂Ô∏è Watch Ad & Earn 0.5 Points';
            },
            onInitFailed: (error) => {
                console.error('‚ùå Unity Ads Failed:', error);
                showNotification('‚ö†Ô∏è Ads system loading...');
                // Fallback to custom ads
                setTimeout(initializeFallbackAds, 2000);
            }
        };
        
        // ==================== VARIABLES ====================
        let userData = {
            userId: '',
            balance: 0,
            points: 0,
            adsWatched: 0,
            todayEarned: 0,
            totalEarned: 0,
            withdrawn: 0,
            referrals: 0,
            dailyAds: { date: '', count: 0 },
            streak: 1,
            joinDate: new Date().toISOString(),
            lastAdTime: 0
        };
        
        let isUnityAdsReady = false;
        let isShowingAd = false;
        
        // ==================== UNITY ADS FUNCTIONS ====================
        function initializeUnityAds() {
            console.log('üöÄ Initializing Unity Ads...');
            
            if (typeof unityAds !== 'undefined') {
                try {
                    unityAds.init(UNITY_CONFIG.gameId, {
                        testMode: UNITY_CONFIG.testMode,
                        onComplete: UNITY_CONFIG.onInitComplete,
                        onFailed: UNITY_CONFIG.onInitFailed
                    });
                    isUnityAdsReady = true;
                } catch (error) {
                    console.error('Unity init error:', error);
                    loadFallbackAds();
                }
            } else {
                console.error('Unity SDK not loaded, retrying...');
                setTimeout(loadUnitySDK, 3000);
            }
        }
        
        function loadUnitySDK() {
            const script = document.createElement('script');
            script.src = 'https://webgl.unityads.unity3d.com/main.js';
            script.onload = () => {
                console.log('‚úÖ Unity SDK loaded');
                initializeUnityAds();
            };
            script.onerror = () => {
                console.error('‚ùå Failed to load Unity SDK');
                loadFallbackAds();
            };
            document.head.appendChild(script);
        }
        
        function loadFallbackAds() {
            console.log('üîÑ Loading fallback ad system...');
            // Monetag ‡¶¨‡¶æ ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶ï‡ßã‡¶® Ads system
            initializeMonetagAds();
        }
        
        function initializeMonetagAds() {
            // Monetag fallback system
            console.log('Monetag fallback activated');
            // ‡¶Ü‡¶™‡¶®‡¶ø ‡¶è‡¶ñ‡¶æ‡¶®‡ßá Monetag ‡¶¨‡¶æ ‡¶Ö‡¶®‡ßç‡¶Ø Ad network ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®
        }
        
        // ==================== WATCH AD FUNCTION ====================
        async function watchAd() {
            // Check if already showing ad
            if (isShowingAd) {
                showNotification('‚ö†Ô∏è Please wait, ad is loading...');
                return;
            }
            
            // Check cooldown
            const now = Date.now();
            if (now - userData.lastAdTime < CONFIG.minAdInterval) {
                const remaining = Math.ceil((CONFIG.minAdInterval - (now - userData.lastAdTime)) / 1000);
                showNotification(`‚è∞ Please wait ${remaining} seconds`);
                return;
            }
            
            // Check daily limit
            if (userData.dailyAds.count >= CONFIG.dailyAdLimit) {
                showNotification('üéØ Daily ad limit reached! Come back tomorrow.');
                return;
            }
            
            // Disable button
            const btn = document.getElementById('adButton');
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<span class="loader"></span> Loading Ad...';
            isShowingAd = true;
            
            try {
                let adWatched = false;
                
                // Try Unity Ads first
                if (isUnityAdsReady && typeof unityAds !== 'undefined') {
                    adWatched = await showUnityAd();
                }
                
                // If Unity failed, show custom ad
                if (!adWatched) {
                    adWatched = await showCustomAd();
                }
                
                if (adWatched) {
                    // Reward user
                    rewardUserForAd();
                    showNotification(`‚úÖ +${CONFIG.pointsPerAd} points earned!`);
                    
                    // Update last ad time
                    userData.lastAdTime = Date.now();
                    
                    // Save and update
                    saveData();
                    updateDisplay();
                } else {
                    showNotification('‚ùå Ad not completed');
                }
                
            } catch (error) {
                console.error('Ad error:', error);
                showNotification('‚ö†Ô∏è Error loading ad');
            } finally {
                // Re-enable button
                setTimeout(() => {
                    btn.disabled = false;
                    btn.innerHTML = originalText;
                    isShowingAd = false;
                }, 2000);
            }
        }
        
        function showUnityAd() {
            return new Promise((resolve) => {
                if (!isUnityAdsReady || typeof unityAds === 'undefined') {
                    resolve(false);
                    return;
                }
                
                try {
                    unityAds.show({
                        onCompleted: () => {
                            console.log('üéâ Unity Ad completed');
                            resolve(true);
                        },
                        onFailed: (error) => {
                            console.log('Unity Ad failed:', error);
                            resolve(false);
                        },
                        onSkipped: () => {
                            console.log('User skipped Unity ad');
                            resolve(false);
                        }
                    });
                } catch (error) {
                    console.error('Unity show error:', error);
                    resolve(false);
                }
            });
        }
        
        function rewardUserForAd() {
            userData.dailyAds.count++;
            userData.adsWatched++;
            userData.points += CONFIG.pointsPerAd;
            userData.balance = (userData.points * CONFIG.moneyPerPoint).toFixed(4);
            userData.todayEarned += CONFIG.pointsPerAd * CONFIG.moneyPerPoint;
            userData.totalEarned += CONFIG.pointsPerAd * CONFIG.moneyPerPoint;
            
            // Update streak
            updateStreak();
        }
        
        // ==================== CUSTOM AD FUNCTION (Backup) ====================
        async function showCustomAd() {
            return new Promise((resolve) => {
                // Create overlay
                const overlay = document.createElement('div');
                overlay.className = 'ad-overlay';
                overlay.innerHTML = `
                    <div class="ad-container">
                        <div class="ad-header">
                            <h3>üé¨ Earnly Advertisement</h3>
                        </div>
                        <div class="ad-body">
                            <div class="unity-ad-container" id="unityAdPlaceholder">
                                <div class="ad-loading">
                                    <div class="ad-placeholder">üì∫</div>
                                    <div class="ad-loading-text">Loading advertisement...</div>
                                </div>
                            </div>
                            <div class="ad-reward">Earn ${CONFIG.pointsPerAd} Points</div>
                            <div class="ad-timer" id="adTimer">10</div>
                            <p style="margin: 20px 0; opacity: 0.9;">Watch for 10 seconds to earn</p>
                            <div style="display: flex; gap: 10px; margin-top: 30px;">
                                <button id="skipBtn" style="flex: 1; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: white; border-radius: 10px;">
                                    Skip (No Reward)
                                </button>
                                <button id="closeAdBtn" style="flex: 1; padding: 12px; background: var(--secondary); border: none; color: white; border-radius: 10px; display: none;">
                                    ‚úÖ Get ${CONFIG.pointsPerAd} Points
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(overlay);
                
                let seconds = 10;
                const timerElement = document.getElementById('adTimer');
                const skipBtn = document.getElementById('skipBtn');
                const closeBtn = document.getElementById('closeAdBtn');
                
                // Countdown
                const timer = setInterval(() => {
                    seconds--;
                    timerElement.textContent = seconds;
                    
                    if (seconds <= 0) {
                        clearInterval(timer);
                        skipBtn.style.display = 'none';
                        closeBtn.style.display = 'block';
                    }
                }, 1000);
                
                // Skip
                skipBtn.onclick = () => {
                    clearInterval(timer);
                    document.body.removeChild(overlay);
                    resolve(false);
                };
                
                // Complete
                closeBtn.onclick = () => {
                    clearInterval(timer);
                    document.body.removeChild(overlay);
                    resolve(true);
                };
                
                // Try to load Unity ad in background
                if (isUnityAdsReady) {
                    setTimeout(() => {
                        try {
                            unityAds.show({
                                onCompleted: () => {
                                    // Unity ad completed automatically
                                    clearInterval(timer);
                                    skipBtn.style.display = 'none';
                                    closeBtn.style.display = 'block';
                                    document.getElementById('adTimer').textContent = '0';
                                }
                            });
                        } catch (e) {
                            console.log('Background Unity ad failed');
                        }
                    }, 1000);
                }
            });
        }
        
        // ==================== INITIALIZATION ====================
        function init() {
            // Load user data
            const saved = localStorage.getItem('earnlyProData');
            if (saved) userData = JSON.parse(saved);
            
            // Generate ID if new
            if (!userData.userId) {
                userData.userId = 'EP' + Date.now().toString().slice(-8);
            }
            
            // Telegram Web App
            if (typeof Telegram !== 'undefined') {
                Telegram.WebApp.ready();
                Telegram.WebApp.expand();
                Telegram.WebApp.setHeaderColor('#7C3AED');
            }
            
            // Check daily reset
            checkDailyReset();
            
            // Initialize Unity Ads
            setTimeout(() => {
                if (typeof unityAds !== 'undefined') {
                    initializeUnityAds();
                } else {
                    loadUnitySDK();
                }
            }, 1000);
            
            // Update display
            updateDisplay();
            
            // Welcome notification
            setTimeout(() => showNotification('üíé Welcome to Earnly Pro!'), 1500);
        }
        
        // ==================== OTHER FUNCTIONS ====================
        function showNotification(message) {
            const notif = document.getElementById('notification');
            notif.textContent = message;
            notif.style.display = 'block';
            
            // Auto hide
            setTimeout(() => {
                notif.style.display = 'none';
            }, 3000);
        }
        
        function saveData() {
            localStorage.setItem('earnlyProData', JSON.stringify(userData));
        }
        
        function updateDisplay() {
            // Update all values
            document.getElementById('balance').textContent = parseFloat(userData.balance).toFixed(4);
            document.getElementById('points').textContent = userData.points.toFixed(1);
            document.getElementById('todayEarned').textContent = (userData.todayEarned * CONFIG.moneyPerPoint).toFixed(4);
            document.getElementById('adsCount').textContent = userData.adsWatched;
            document.getElementById('totalEarned').textContent = (userData.totalEarned * CONFIG.moneyPerPoint).toFixed(2);
            document.getElementById('referrals').textContent = userData.referrals;
            document.getElementById('withdrawn').textContent = userData.withdrawn.toFixed(2);
            document.getElementById('streak').textContent = userData.streak;
            
            // Update ad progress
            const count = userData.dailyAds.count;
            const limit = CONFIG.dailyAdLimit;
            const progress = (count / limit) * 100;
            const remaining = 339.292 - (progress * 339.292 / 100);
            
            document.getElementById('dailyCount').textContent = `${count}/${limit}`;
            document.getElementById('progressText').textContent = `${Math.round(progress)}%`;
            document.getElementById('ringPercent').textContent = `${Math.round(progress)}%`;
            
            // Update progress ring
            const circle = document.querySelector('.progress-ring circle:nth-child(2)');
            if (circle) {
                circle.style.strokeDashoffset = remaining;
            }
        }
        
        function checkDailyReset() {
            const today = new Date().toDateString();
            if (userData.dailyAds.date !== today) {
                userData.dailyAds.date = today;
                userData.dailyAds.count = 0;
                userData.todayEarned = 0;
                saveData();
            }
        }
        
        function updateStreak() {
            const today = new Date().toDateString();
            const lastDate = localStorage.getItem('lastAdDate');
            
            if (lastDate === today) {
                return;
            }
            
            if (!lastDate) {
                userData.streak = 1;
            } else {
                const last = new Date(lastDate);
                const current = new Date(today);
                const diff = Math.floor((current - last) / (1000 * 60 * 60 * 24));
                
                if (diff === 1) {
                    userData.streak++;
                } else if (diff > 1) {
                    userData.streak = 1;
                }
            }
            
            localStorage.setItem('lastAdDate', today);
        }
        
        function showSection(sectionId) {
            // Hide all
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            
            // Show selected
            document.getElementById(sectionId)?.classList.add('active');
            event.target.closest('.nav-btn')?.classList.add('active');
        }
        
        // Start app
        window.onload = init;
    </script>
</body>
</html>
